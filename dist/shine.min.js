/*! shine.js - v0.1.0 - 2014-04-08
* http://bigspaceship.github.io/shine.js
* Copyright (c) 2014 Big Spaceship; Licensed MIT */

!function(a,b){"use strict";b.shinejs=a,a.Color=function(a,b,c){this.r=a||0,this.g=b||0,this.b=c||0},a.Light=function(){this.position=new a.Point(0,0),this.intensity=1},a.Point=function(a,b){this.x=a||0,this.y=b||0},a.Point.prototype.delta=function(b){return new a.Point(b.x-this.x,b.y-this.y)},a.Shadow=function(b){var c=this;this.stepSize=8,this.maxSteps=5,this.opacityMultiplier=.15,this.opacityPow=1.2,this.offsetMultiplier=.15,this.offsetPow=1.8,this.blurMultiplier=.1,this.blurPow=1.4,this.maxBlurRadius=64,this.position=new a.Point(0,0),this.domElement=b,this.shadowProperty="textShadow",this.shadowRGB=new a.Color(0,0,0),this.fnHandleViewportUpdate=function(){c.handleViewportUpdate()},this.enableAutoUpdates(),this.handleViewportUpdate()},a.Shadow.prototype.draw=function(a){var b=this.position.delta(a.position),c=Math.sqrt(b.x*b.x+b.y*b.y);c=Math.max(40,c);var d=c/this.stepSize;d=Math.min(this.maxSteps,Math.round(d));for(var e=[],f=0;d>f;f++){var g=f/d,h=Math.pow(g,this.opacityPow),i=Math.pow(g,this.offsetPow),j=Math.pow(g,this.blurPow),k=a.intensity*Math.max(0,this.opacityMultiplier*(1-h)),l=-this.offsetMultiplier*b.x*i,m=-this.offsetMultiplier*b.y*i,n=this.blurMultiplier*c*j;n=Math.min(this.maxBlurRadius,n);var o=this.getShadow(this.shadowRGB,k,l,m,n);e.push(o)}this.drawShadows(e)},a.Shadow.prototype.getShadow=function(a,b,c,d,e){var f="rgba("+a.r+", "+a.g+", "+a.b+", "+b+")";return f+" "+c+"px "+d+"px "+e+"px"},a.Shadow.prototype.drawShadows=function(a){this.domElement.style[this.shadowProperty]=a.join(", ")},a.Shadow.prototype.enableAutoUpdates=function(){this.disableAutoUpdates();var a=this.fnHandleViewportUpdate,b=document.addEventListener,c=window.addEventListener;b("resize",a,!1),b("load",a,!1),c("resize",a,!1),c("scroll",a,!1)},a.Shadow.prototype.disableAutoUpdates=function(){var a=this.fnHandleViewportUpdate,b=document.removeEventListener,c=window.removeEventListener;b("resize",a,!1),b("load",a,!1),c("resize",a,!1),c("scroll",a,!1)},a.Shadow.prototype.handleViewportUpdate=function(){var a=this.domElement.getBoundingClientRect();this.position.x=a.left+.5*a.width,this.position.y=a.top+.5*a.height},a.Splitter=function(a,b){this.domElement=a,this.classPrefix=b||"",this.wrapperElement=document.createElement("div"),this.maskElement=document.createElement("div"),this.wordElements=[],this.elements=[],this.text=""},a.Splitter.prototype.split=function(a){this.text=a||this.text,this.wordElements.length=0,this.elements.length=0,this.wrapperElement.className=this.classPrefix+"wrapper",this.wrapperElement.innerHTML="";var b=this.hasTextOnly(this.domElement);a&&(this.domElement.textContent=this.text),b?this.splitText(this.domElement,this.maskElement,this.wrapperElement,this.classPrefix):this.splitChildren(this.domElement,this.maskElement,this.wrapperElement,this.classPrefix)},a.Splitter.prototype.hasTextOnly=function(a){var b=a.childNodes;if(console.log(b),!b||0===b.length)return!0;for(var c=0;c<b.length;c++)if(3!==b[c].nodeType)return!1;return!0},a.Splitter.prototype.splitChildren=function(a,b,c,d){for(var e=a.childNodes,f=0;f<e.length;f++){var g=e[f];1===g.nodeType&&(g.className+=" "+d+"letter",c.appendChild(g),this.elements.push(g))}b.innerHTML=c.innerHTML,b.className=d+"mask",c.appendChild(b),a.innerHTML="",a.appendChild(c)},a.Splitter.prototype.splitText=function(a,b,c,d){for(var e=a.textContent,f=e.length,g=null,h=0;f>h;h++){var i=e.charAt(h);if(g||(g=document.createElement("span"),g.className=d+"word",c.appendChild(g),this.wordElements.push(g)),i.match(/[\s]/)){var j=document.createElement("span");j.className=d+"spacer",j.innerHTML=i,c.appendChild(j),g=null}else{var k=document.createElement("span");k.innerHTML=i,k.className=d+"letter",this.elements.push(k),g.appendChild(k),i.match(/[\W]/)&&(g=null)}}b.innerHTML=c.innerHTML,b.className=d+"mask",c.appendChild(b),a.innerHTML="",a.appendChild(c)},a.StyleInjector=function(){this.injections={}},a.StyleInjector.instance_=null,a.StyleInjector.getInstance=function(){return a.StyleInjector.instance_||(a.StyleInjector.instance_=new a.StyleInjector),a.StyleInjector.instance_},a.StyleInjector.prototype.inject=function(a,b){if(b=b||window.document,this.injections[a]!==b){var c=document.createElement("style");c.type="text/css",c.innerHTML=a;var d=b.getElementsByTagName("head")[0].firstChild;return b.getElementsByTagName("head")[0].insertBefore(c,d),this.injections[a]=b,c}},a.Shine=function(b,c,d){var e=this;if(!b)throw new Error("No valid DOM element passed as first parameter");this.classPrefix=c||"shine-",this.shadowProperty=d||"textShadow",this.domElement=b,this.light=new a.Light,this.shadows=[],this.splitter=new a.Splitter(b,this.classPrefix),this.areAutoUpdatesEnabled=!0,this.fnDrawHandler=function(){e.draw()},this.update()},a.Shine.prototype.destroy=function(){this.disableAutoUpdates(),this.light=null,this.shadows=null,this.splitter=null,this.fnDrawHandler=null},a.Shine.prototype.draw=function(){for(var a=0;a<this.shadows.length;a++){var b=this.shadows[a];b.draw(this.light)}},a.Shine.prototype.update=function(b){var c=this.areAutoUpdatesEnabled;this.disableAutoUpdates(),a.StyleInjector.getInstance().inject(this.getCSS()),this.shadows.length=0,this.splitter.split(b);for(var d=0;d<this.splitter.elements.length;d++){var e=this.splitter.elements[d],f=new a.Shadow(e);f.shadowProperty=this.shadowProperty,this.shadows.push(f)}c&&this.enableAutoUpdates(),this.draw()},a.Shine.prototype.enableAutoUpdates=function(){this.disableAutoUpdates(),this.areAutoUpdatesEnabled=!0;var a=window.addEventListener,b=this.fnDrawHandler;a("scroll",b,!1),a("resize",b,!1);for(var c=this.shadows.length-1;c>=0;c--){var d=this.shadows[c];d.enableAutoUpdates()}},a.Shine.prototype.disableAutoUpdates=function(){this.areAutoUpdatesEnabled=!1;var a=window.removeEventListener,b=this.fnDrawHandler;a("scroll",b,!1),a("resize",b,!1);for(var c=this.shadows.length-1;c>=0;c--){var d=this.shadows[c];d.disableAutoUpdates()}},a.Shine.prototype.getCSS=function(){return"/* shine.js styles */.shine-wrapper { display: inline-block; position: relative; max-width: 100%;}.shine-word { display: inline-block; white-space: nowrap;}.shine-letter { position: relative; display: inline-block;}.shine-mask { position: absolute; top: 0; left: 0; right: 0; bottom: 0;}"},b.Shine=b.Shine||a.Shine}({},function(){return this}());
//# sourceMappingURL=shine.min.map